<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> SQL学习(一) · 金缮的随笔</title><meta name="description" content="SQL学习(一) - 晓松"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="yexiaosong.github.io/atom.xml" title="金缮的随笔"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="金缮的随笔" type="application/atom+xml">
</head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">金缮的随笔</h2></a></div><a href="/" target="_self" class="li component-nav-item"><p>主页</p></a><a href="/archives" target="_self" class="li component-nav-item"><p>归档</p></a><a href="/about" target="_self" class="li component-nav-item"><p>关于</p></a><ul class="shortcut-icons"><a href="https://github.com/yexiaosong" target="_blank"><img src="/images/github.svg" class="icon"></a><a href="https://www.zhihu.com/people/yexiaosong" target="_blank"><img src="/images/zhihu.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">SQL学习(一)</h1><div class="post-info">2017年6月5日</div><div class="post-content"><h1 id="sql"><a href="#sql" class="headerlink" title="sql"></a>sql</h1><p>sql简介</p>
<h2 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">创建: <span class="keyword">create</span> <span class="keyword">database</span> mydb;</span><br><span class="line">使用: <span class="keyword">use</span> mydb;</span><br><span class="line">删除: <span class="keyword">drop</span> <span class="keyword">database</span> mydb;</span><br><span class="line">查看使用的数据库: <span class="keyword">select</span> <span class="keyword">database</span>();</span><br><span class="line">将当前目录下的sql文件导入sql数据库：SOURCE ./mysql.sql;</span><br></pre></td></tr></table></figure>
<h2 id="表的操作"><a href="#表的操作" class="headerlink" title="表的操作"></a>表的操作</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">创建：<span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span>(<span class="keyword">id</span> <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span> auto_increment primary <span class="keyword">key</span>，<span class="keyword">user</span> <span class="built_in">varchar</span>(<span class="number">20</span>));</span><br><span class="line">插入：<span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="number">0</span>)</span><br><span class="line">删除：<span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">user</span></span><br><span class="line">清空表：<span class="keyword">delete</span> <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">user</span></span><br><span class="line">查看表结构 <span class="keyword">describe</span> <span class="keyword">user</span></span><br><span class="line">按照表的结构添加数据：<span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="number">0</span>,<span class="string">"alex"</span>)</span><br><span class="line">指定添加部分值： <span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> (<span class="keyword">id</span>) <span class="keyword">values</span> (<span class="number">1</span>)。即可只插入<span class="keyword">id</span></span><br><span class="line">修改表中的元素： <span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> <span class="keyword">user</span>=<span class="string">'jack'</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>, 这样可以将上一步骤中的<span class="keyword">user</span>设置为jack</span><br></pre></td></tr></table></figure>
<h2 id="表的编辑"><a href="#表的编辑" class="headerlink" title="表的编辑"></a>表的编辑</h2><h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ 逻辑删除</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">user</span> <span class="keyword">add</span> isdelete <span class="built_in">bit</span> <span class="keyword">default</span> <span class="number">0</span>;//更改了表的结构</span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> isdelete=<span class="number">1</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>;//给表赋值</span><br><span class="line">+ 物理删除</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> ...</span><br></pre></td></tr></table></figure>
<h3 id="数据备份"><a href="#数据备份" class="headerlink" title="数据备份"></a>数据备份</h3><ol>
<li>sudo su</li>
<li>cd /var/lib/mysql</li>
<li>mysqldump -uroot -p 数据库名 &gt; ~/user/backup.sql</li>
</ol>
<h3 id="数据恢复"><a href="#数据恢复" class="headerlink" title="数据恢复"></a>数据恢复</h3><ul>
<li>mysql -uroot -p 数据库名 &lt; ~/user/backup.sql</li>
</ul>
<p>##查询操作</p>
<h3 id="去重"><a href="#去重" class="headerlink" title="去重"></a>去重</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> age <span class="keyword">from</span> <span class="keyword">user</span></span><br><span class="line">&lt;!<span class="comment">-- distinct 关键字筛选的是整句的条件 --&gt;</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> <span class="keyword">id</span>,age <span class="keyword">from</span> <span class="keyword">user</span></span><br><span class="line">&lt;!<span class="comment">-- 必须id和age都不同才算不重复 --&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> age=<span class="number">20</span> <span class="keyword">and</span> <span class="keyword">name</span>=<span class="string">'jack'</span>;</span><br></pre></td></tr></table></figure>
<h3 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select * from user where name like &#39;J%&#39;;</span><br><span class="line">表示从表中查找已J开头，后面可以有任意位的数据。</span><br><span class="line">select * from user where name like &#39;J_&#39;</span><br><span class="line">表示查询表中以J开头，后面可以有一位的数据。</span><br></pre></td></tr></table></figure>
<h3 id="范围查询"><a href="#范围查询" class="headerlink" title="范围查询"></a>范围查询</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">in</span>(<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>);</span><br><span class="line">取出id为1,3,4的数据</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">between</span> <span class="number">1</span> <span class="keyword">and</span> <span class="number">3</span>;</span><br><span class="line">取出id从1到3的数据</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> age <span class="keyword">is</span> <span class="literal">null</span>;</span><br><span class="line">取出user表中age为null的数据</span><br><span class="line"></span><br><span class="line">优先级：</span><br><span class="line">小括号&gt;not&gt;比较运算符&gt;逻辑运算符</span><br></pre></td></tr></table></figure>
<h3 id="聚合查询"><a href="#聚合查询" class="headerlink" title="聚合查询"></a>聚合查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line">搜索user表中数据总数</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">min</span>(<span class="keyword">id</span>) <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line">找最小的id,同理有max</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">sum</span>(<span class="keyword">id</span>) <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line">奖user的id加起来，同理有avg(列)求此列的平均值</span><br></pre></td></tr></table></figure>
<h3 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> age, <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">group</span> <span class="keyword">by</span> age <span class="keyword">having</span> <span class="keyword">count</span>(*)&gt;<span class="number">2</span>;</span><br><span class="line">where 是对原始集合进行筛选，having 是对 group by刷选后的值进行筛选。如果使用：</span><br><span class="line"><span class="keyword">select</span> age, <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">group</span> <span class="keyword">by</span> age <span class="keyword">having</span> rs&gt;<span class="number">2</span>; 则筛选出来的结果第二列名为rs</span><br></pre></td></tr></table></figure>

<h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">order</span> <span class="keyword">by</span> age <span class="keyword">asc</span>(升序) | <span class="keyword">desc</span> (降序), <span class="keyword">name</span> <span class="keyword">asc</span> | <span class="keyword">desc</span></span><br><span class="line">先按age行排，然后再按<span class="keyword">name</span>行排</span><br></pre></td></tr></table></figure>

<h3 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">limit</span> <span class="keyword">start</span>,<span class="keyword">count</span> ,</span><br><span class="line">其中<span class="keyword">start</span>从<span class="number">0</span>开始 ，所以在求第n页数据时，<span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> age=<span class="number">22</span> <span class="keyword">limit</span> (n<span class="number">-1</span>)*m,m</span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><blockquote>
<p>select distinct * from TABLENAME where … group by … having … order by … limit start,count,其中，执行顺序为from TABLENAME -&gt;where …-&gt; group by …-&gt; select distinct -&gt; having… -&gt; order by … -&gt; limit start,count</p>
</blockquote>
</div></article></div></div></main><footer class="footer-container"><div class="paginator"><a href="/2017/09/05/python%E5%AD%A6%E4%B9%A0/" class="prev">上一篇</a><a href="/2017/01/14/jade%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="next">下一篇</a></div><div class="copyright"><p>© 2017 - 2020 <a href="yexiaosong.github.io">晓松</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer></body></html>