<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> SQL学习(二) · 金缮的随笔</title><meta name="description" content="SQL学习(二) - 晓松"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="yexiaosong.github.io/atom.xml" title="金缮的随笔"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="金缮的随笔" type="application/atom+xml">
</head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">金缮的随笔</h2></a></div><a href="/" target="_self" class="li component-nav-item"><p>主页</p></a><a href="/archives" target="_self" class="li component-nav-item"><p>归档</p></a><a href="/about" target="_self" class="li component-nav-item"><p>关于</p></a><ul class="shortcut-icons"><a href="https://github.com/yexiaosong" target="_blank"><img src="/images/github.svg" class="icon"></a><a href="https://www.zhihu.com/people/yexiaosong" target="_blank"><img src="/images/zhihu.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">SQL学习(二)</h1><div class="post-info">2017年9月7日</div><div class="post-content"><h2 id="表的关系"><a href="#表的关系" class="headerlink" title="表的关系"></a>表的关系</h2><h3 id="外键约束"><a href="#外键约束" class="headerlink" title="外键约束"></a>外键约束</h3><p>为了防止插入无效数据，使用外键约束，而且添加了几个表之间的关系</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">scroll</span>(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">int</span> auto_increment primary <span class="keyword">key</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    <span class="keyword">foreign</span> <span class="keyword">key</span>(usrid) <span class="keyword">references</span> <span class="keyword">user</span>(<span class="keyword">id</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> subject <span class="keyword">add</span> <span class="keyword">constraint</span> stu <span class="keyword">foreign</span> <span class="keyword">key</span>(stuid) <span class="keyword">references</span> student(<span class="keyword">id</span>);</span><br></pre></td></tr></table></figure>
<h3 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h3><p>以学生表为例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> students.nam, subjects.title, scores.score <span class="keyword">from</span> scores</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> students <span class="keyword">on</span> scores.stuid=students.id</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> subjects <span class="keyword">on</span> scores.subid=subjects.id;</span><br></pre></td></tr></table></figure>
<p>这样可以将学生表中的分数以姓名，科目和分数三列展示出来，否则会只展示学生和成绩的ID。</p>
<ul>
<li>inner join 连接的表中，在所有的表中都会出现的数据才会展现。</li>
<li>left join 以左表为准，此例中将student中的数据全都展现出来。其他位置没有数据以null填充</li>
<li>right join 首先将多有表都有的数据展现，后将右边独有的数据填充，左端没有的以null填充</li>
</ul>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p>为了实现对SQL语句的复用，使用view对语句进行封装</p>
<h3 id="试图创建"><a href="#试图创建" class="headerlink" title="试图创建"></a>试图创建</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> v_stu <span class="keyword">as</span> </span><br><span class="line"><span class="keyword">select</span> student.*, scores.score <span class="keyword">from</span> scores</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> students <span class="keyword">on</span> scores.stuid = students.id;</span><br></pre></td></tr></table></figure>
<h3 id="视图的使用"><a href="#视图的使用" class="headerlink" title="视图的使用"></a>视图的使用</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> v_stu;</span><br></pre></td></tr></table></figure>

<h2 id="自关联查询"><a href="#自关联查询" class="headerlink" title="自关联查询"></a>自关联查询</h2><p>相当于将数据合成大表，再进行选择。(实际使用一张表，但是逻辑上是多个表)</p>
<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><h3 id="begin-—-gt-commit-—-gt-rollback"><a href="#begin-—-gt-commit-—-gt-rollback" class="headerlink" title="begin —&gt; commit —&gt;rollback"></a>begin —&gt; commit —&gt;rollback</h3><p>begin提交到内存，commit存至硬盘，rollback回到begin之前。相当于java中的进程锁。只要有失败，此次操作就失败。</p>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><h3 id="原则"><a href="#原则" class="headerlink" title="原则"></a>原则</h3><ul>
<li>避免存NUll，除非有特殊要求</li>
<li>数字比字符串效率更高</li>
<li>连接查询将优先级高的放前面，如=放在范围之前。尽量少用or</li>
</ul>
</div></article></div></div></main><footer class="footer-container"><div class="paginator"><a href="/2017/09/14/python%E5%B0%8F%E7%9F%A5%E8%AF%86%E7%82%B9/" class="prev">上一篇</a><a href="/2017/09/05/python%E5%AD%A6%E4%B9%A0/" class="next">下一篇</a></div><div class="copyright"><p>© 2017 - 2021 <a href="yexiaosong.github.io">晓松</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer></body></html>