<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> vue引入ueditor及node后台配置 · 金缮的随笔</title><meta name="description" content="vue引入ueditor及node后台配置 - 晓松"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="yexiaosong.github.io/atom.xml" title="金缮的随笔"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="金缮的随笔" type="application/atom+xml">
</head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">金缮的随笔</h2></a></div><a href="/" target="_self" class="li component-nav-item"><p>主页</p></a><a href="/archives" target="_self" class="li component-nav-item"><p>归档</p></a><a href="/about" target="_self" class="li component-nav-item"><p>关于</p></a><ul class="shortcut-icons"><a href="https://github.com/yexiaosong" target="_blank"><img src="/images/github.svg" class="icon"></a><a href="https://www.zhihu.com/people/yexiaosong" target="_blank"><img src="/images/zhihu.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">vue引入ueditor及node后台配置</h1><div class="post-info">2017年11月13日</div><div class="post-content"><p>最近公司的某个客户要用上我们公司的产品，他的后台管理里的富文本编辑器要求有点多，开始打算用Quill，但是发现Quill根本满足不了他的需求。在调研了市面上的富文本编辑器后，最后似乎只剩了百度的ueditor。虽然很丑<del>~</del>，不过没关系，政府网站和这种效果更搭:-D 我是不是说了什么（逃</p>
<h2 id="vue引入ueditor"><a href="#vue引入ueditor" class="headerlink" title="vue引入ueditor"></a>vue引入ueditor</h2><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><ol>
<li>百度ueditor下载，随便哪个版本就好(本文章以php版为例)，不需要特别全面功能的可以考虑下UM喽</li>
<li>将对应的文件夹放到static中</li>
<li>修改前端vue部分引用的ueditor.confg.js，设置路径window.UEDITOR_HOME_URL = “/static/utf8-php/“<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.UEDITOR_HOME_URL = <span class="string">"/static/utf8-php/"</span></span><br><span class="line">    <span class="keyword">var</span> URL = <span class="built_in">window</span>.UEDITOR_HOME_URL || getUEBasePath();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置项主体。注意，此处所有涉及到路径的配置别遗漏URL变量。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">window</span>.UEDITOR_CONFIG = &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//为编辑器实例添加一个路径，这个不能被注释</span></span><br><span class="line">        UEDITOR_HOME_URL: URL</span><br><span class="line">        <span class="comment">// 服务器统一请求接口路径</span></span><br><span class="line">        , <span class="attr">serverUrl</span>: <span class="string">"http://localhost:3000/ueditor/ue"</span></span><br><span class="line">    <span class="comment">// ............   下面忽略................</span></span><br></pre></td></tr></table></figure></li>
<li>编写vue文件,我已经把static配置到webpack的路径里了，自己可以相应更改，ueditor中的各项方法可以在自己下载的百度ueditor包的index.html中找。<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"hello"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">"editor"</span> <span class="attr">type</span>=<span class="string">"text/plain"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"show"</span>&gt;</span>你敢点一下吗？<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">  name: <span class="string">'HelloWorld'</span>,</span></span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">      editor: <span class="literal">null</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    show () &#123;</span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.editor.getContent())</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted () &#123;</span><br><span class="line"><span class="javascript">    <span class="built_in">require</span>(<span class="string">'static/utf8-php/ueditor.config.js'</span>)</span></span><br><span class="line"><span class="javascript">    <span class="built_in">require</span>(<span class="string">'static/utf8-php/ueditor.all.min.js'</span>)</span></span><br><span class="line"><span class="javascript">    <span class="built_in">require</span>(<span class="string">'static/utf8-php/lang/zh-cn/zh-cn.js'</span>)</span></span><br><span class="line"><span class="javascript">    <span class="built_in">require</span>(<span class="string">'static/utf8-php/ueditor.parse.min.js'</span>)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">this</span>.editor = <span class="built_in">window</span>.UE.getEditor(<span class="string">'editor'</span>)</span></span><br><span class="line">  &#125;,</span><br><span class="line">  destroyed () &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">this</span>.editor.destroy()</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3></li>
<li>在步骤3中的路径一定要有最后一个”/“</li>
<li>步骤3中的serverUrl写成对应的服务端地址</li>
</ol>
<h2 id="node后端处理"><a href="#node后端处理" class="headerlink" title="node后端处理"></a>node后端处理</h2><h3 id="express-实现"><a href="#express-实现" class="headerlink" title="express 实现"></a>express 实现</h3><p>网上有人已经实现了express版的，使用express的有福了。不过我直接用他的是不能直接用的，在浏览器中报”: unexcepected “，我将他的代码改了一下，不让它在返回配置是重定向，而是直接返回一个jsonp，jsonp内容设置为百度的ueditor包中的php文件下的config.json，记得用正则表达式或者直接用手把注释去掉，json是没有注释的。<br>这时你可能发现不报错了，但是图片上传会错误，报404。其实图片已经上传成功了，只是没有正确的加载，因为返回的路径只是路径，不是完整的url，就会请求到前端服务域下。（例如<a href="http://localhost:8080/**)。此时修改config.json中&quot;imageUrlPrefix&quot;" target="_blank" rel="noopener">http://localhost:8080/**)。此时修改config.json中&quot;imageUrlPrefix&quot;</a>: “<a href="http://localhost:3000&quot;,就可以将图片路径补充完整。跨域问题自己解决哈-----">http://localhost:3000&quot;,就可以将图片路径补充完整。跨域问题自己解决哈-----</a></p>
<ol>
<li>res.jsonp(config.json)</li>
<li>给config.json的imageUrlPrefix加后端域<h3 id="koa实现"><a href="#koa实现" class="headerlink" title="koa实现"></a>koa实现</h3>这时个比较精巧的库，而且将在v3中去掉了generator写法，generator现在已经渐渐不被支持，所以使用async写法吧。我主要用了await-busboy这个库，实现文件处理。</li>
<li>实现判断<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ActionType = ctx.query.action</span><br><span class="line"><span class="comment">// 当ActionType为config时返回与express中一样的json</span></span><br><span class="line"><span class="comment">// 当为uploadimage或uploadfile时处理</span></span><br></pre></td></tr></table></figure></li>
<li>处理上传<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> parse = <span class="built_in">require</span>(<span class="string">'await-busboy'</span>)</span><br><span class="line"><span class="keyword">const</span> parts = parse(ctx)</span><br><span class="line">    <span class="keyword">let</span> part,</span><br><span class="line">        stream,</span><br><span class="line">        tmp_name,</span><br><span class="line">        file_path,</span><br><span class="line">        filename</span><br><span class="line">    <span class="keyword">while</span> ((part = <span class="keyword">await</span> parts)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (part.length) &#123;</span><br><span class="line">          <span class="comment">// 此处解析到form的fields</span></span><br><span class="line">          <span class="built_in">console</span>.log(&#123; <span class="attr">key</span>: part[<span class="number">0</span>], <span class="attr">value</span>: part[<span class="number">1</span>] &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 此处解析到文件并以可读流形式返回，通过nodejs官方API存储</span></span><br><span class="line">        <span class="keyword">if</span>(ActionType === <span class="string">'uploadimage'</span> &amp;&amp; img_type.indexOf(path.extname(part.filename)) &gt;= <span class="number">0</span> )&#123;</span><br><span class="line">            filename = <span class="string">'pic_'</span>+ (<span class="keyword">new</span> <span class="built_in">Date</span>()).getTime() + <span class="string">'_'</span> + part.filename</span><br><span class="line">            file_path = path.join(img_path, filename)</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ActionType === <span class="string">'uploadfile'</span>)&#123;</span><br><span class="line">            filename = <span class="string">'file_'</span>+(<span class="keyword">new</span> <span class="built_in">Date</span>()).getTime()+<span class="string">'_'</span>+part.filename</span><br><span class="line">            file_path = path.join(files_path, filename)</span><br><span class="line">        &#125;</span><br><span class="line">        stream = fs.createWriteStream(path.join(static_path,file_path))</span><br><span class="line">        part.pipe(stream)</span><br><span class="line">        tmp_name = part.filename</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 返回json也要返回对应的jsonp形式哦~~</span></span><br></pre></td></tr></table></figure>
到这大概可以了，自己去试一下吧~~</li>
</ol>
</div></article></div></div></main><footer class="footer-container"><div class="paginator"><a href="/2018/06/20/React-Native-%E7%9C%9F%E7%9A%84%E6%98%AF%E7%A7%BB%E5%8A%A8%E5%BC%80%E5%8F%91%E7%9A%84%E6%9C%AA%E6%9D%A5%E5%90%97/" class="prev">上一篇</a><a href="/2017/09/28/python-%E7%BD%91%E7%BB%9C/" class="next">下一篇</a></div><div class="copyright"><p>© 2017 - 2020 <a href="yexiaosong.github.io">晓松</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer></body></html>